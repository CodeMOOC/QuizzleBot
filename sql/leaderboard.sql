# Leaderboard for session, by number of correct responses and cumulative time
SELECT IF(`identity`.`group_name` IS NOT NULL, `identity`.`group_name`, `identity`.`full_name`) AS `name`, `identity`.`participants_count`, count(*) AS `correct`, SUM(TIME_TO_SEC(TIMEDIFF(`answer`.`last_update`, `riddle`.`start_time`))) AS `cumul_time_secs` FROM `riddle` LEFT OUTER JOIN `answer` ON `riddle`.`id` = `answer`.`riddle_id` LEFT OUTER JOIN `identity` ON `answer`.`telegram_id` = `identity`.`telegram_id` WHERE `riddle`.`session_id` = 3 AND `riddle`.`answer` = `answer`.`text` AND `answer`.`last_update` <= `riddle`.`end_time` GROUP BY `answer`.`telegram_id` ORDER BY `correct` DESC, `cumul_time_secs` ASC;
